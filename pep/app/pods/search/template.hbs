{{page-title "Search"}}
<div class="page-content page-content-sectioned">
    <div class="page-content-section flex-fill">
        <Scrollable class="page-content-inner">
            {{#if (and (not this.model) this.isLoadingPage)}}
                <div class="d-flex align-items-center py-3 px-4">
                    <Progress::Spinner class="mr-1" />
                    <span class="text-muted">Loading results...</span>
                </div>
            {{else}}
                {{#if this.noResults}}
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="p-5 text-muted">
                            {{#if this.hasSubmittedSearch}}
                                <p class="my-4 p-3 bg-backdrop-well rounded">
                                    No results found. Try using different search terms or phrases to find what you're looking for.
                                </p>
                                <p class="d-lg-none mb-4">
                                    <Button
                                        @type="primary"
                                        @size="lg"
                                        @blockLayout={{this.media.isMobile}}
                                        @icon="search"
                                        @label="Start a new search"
                                        @action={{this.showSearch}}
                                    />
                                </p>
                            {{else}}
                                <h5>Your search starts here</h5>
                                <p class="mb-4">
                                    <FaIcon @icon="arrow-left" />
                                    Use the form on the left to enter terms or phrases and search our publication database.
                                </p>
                                <p class="d-lg-none mb-4">
                                    <Button
                                        @type="primary"
                                        @size="lg"
                                        @blockLayout={{this.media.isMobile}}
                                        @icon="search"
                                        @label="Start a new search"
                                        @action={{this.showSearch}}
                                    />
                                </p>
                                <h5>Search tips</h5>
                                <p>
                                    Smart Search taskes all kinds of search inputs:
                                </p>
                                <ul>
                                    <li>
                                        Find terms or keywords - to get the best search results, <strong>enter at least two terms at a time.</strong><br>
                                        This will make the search more precise, returning only the most relevant results.
                                    </li>
                                    <li>Paste a reference from an article</li>
                                    <li>Use a Journal name or part of a journal name</li>
                                    <li>Search on author name (or multiple authors)</li>
                                    <li>Use part of a title (two or more words)</li>
                                    <li>Search by Year / Vol / Page #</li>
                                </ul>
                            {{/if}}
                        </div>
                    </div>
                {{else}}
                    <div class="py-3 px-4">
                        <div class="d-md-flex justify-content-between align-items-center mb-3">
                            <h4 class="mb-0">
                                {{format-number (or this.metadata.fullCount 0)}}
                                <span class="text-muted">results</span>
                            </h4>
                            <div class="d-flex align-items-center">
                                <Button
                                    @type="link"
                                    class="text-decoration-none p-1 mr-1"
                                >
                                    <span class="text-muted">Sort:</span>
                                    <span class="text-dark mr-1">Year</span>
                                    <FaIcon @icon="angle-down" class="text-muted" />
                                </Button>
                                <Button
                                    @type="link"
                                    class="text-decoration-none p-1 mr-2"
                                >
                                    <span class="text-muted">View:</span>
                                    <span class="text-dark mr-1">Bibliographic</span>
                                    <FaIcon @icon="angle-down" class="text-muted" />
                                </Button>
                                <Button
                                    @type="link"
                                    @icon="download"
                                    @iconSize="lg"
                                    title="Export"
                                    class="p-1"
                                />
                                <Button
                                    @type="link"
                                    @icon="print"
                                    @iconSize="lg"
                                    title="Print"
                                    class="p-1"
                                />
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <VerticalCollection
                                    @items={{this.model}}
                                    @tagName="ul"
                                    @containerSelector=".page-content-inner"
                                    @class="list-unstyled"
                                    @estimateHeight={{100}}
                                    @lastReached={{this.loadNextPage}}
                                    as |result|
                                >
                                    <li class="mb-4">
                                        <a href="" {{on "click" (fn this.openResultPreview result)}}>
                                            {{result.documentRef}}
                                        </a>
                                        {{#if result.kwicList}}
                                            <ul class="small">
                                                {{#each result.kwicList as |searchHit|}}
                                                    <li>{{{searchHit}}}</li>
                                                {{/each}}
                                            </ul>
                                        {{/if}}
                                    </li>
                                </VerticalCollection>
                                {{#if this.isLoadingPage}}
                                    <div class="d-flex align-items-center">
                                        <Progress::Spinner class="mr-1" />
                                        <span class="text-muted">Loading results...</span>
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                    </div>
                {{/if}}
            {{/if}}
        </Scrollable>
    </div>
    <Search::Preview
        @result={{this.previewedResult}}
        @queryParams={{hash
            q=this.q
            matchSynonyms=this.matchSynonyms
            searchTerms=this._searchTerms
            facets=this._facets
        }}
        @mode={{this.previewMode}}
        @setMode={{this.setPreviewMode}}
        @close={{this.closeResultPreview}}
        @containerSelector=".page-content"
        class="page-content-section"
    />
</div>
